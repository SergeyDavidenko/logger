.PHONY: up down logs test clean

# Start ELK stack
up:
	mkdir -p logs
	docker compose up -d
	@echo "Waiting for services to start..."
	@sleep 30
	@echo "âœ… ELK stack is running! âœ…"
	@echo "âœ… Kibana: http://localhost:5601 âœ…"
	@echo "âœ… Elasticsearch: http://localhost:9200 âœ…"
	@echo "ğŸ³ ELK stack is running! ğŸ³"

# Stop and remove containers
down:
	docker compose down -v
	@echo "ğŸ³ ELK stack is stopped! ğŸ³"

# Show logs of all services
logs:
	docker compose logs -f

# Show only logstash logs
logs-logstash:
	docker compose logs -f logstash

# Run test application
test:
	go run main.go

# Check services status
status:
	@echo "=== Docker containers ==="
	@docker compose ps
	@echo "\n=== Elasticsearch health ==="
	@curl -s http://localhost:9200/_cluster/health?pretty || echo "âŒ Elasticsearch is not available âŒ"

# Clean logs
clean:
	rm -rf logs/*
	@echo "ğŸ§¹ Logs cleaned! ğŸ§¹"
	docker compose down -v
	@echo "ğŸ³ ELK stack is stopped! ğŸ³"

# Full restart
restart: down up

# Show recent logs from files
show-logs:
	@echo "ğŸ“=== Recent logs from files ===ğŸ“"
	@find logs -name "*.log" -type f -exec echo "=== {} ===" \; -exec tail -5 {} \;

help:
	@echo "Available commands:"
	@echo "  up           - Start ELK stack"
	@echo "  down         - Stop and remove containers"
	@echo "  logs         - Show logs of all services"
	@echo "  logs-logstash- Show only logstash logs"
	@echo "  test         - Run test application"
	@echo "  status       - Check services status"
	@echo "  clean        - Clean logs"
	@echo "  restart      - Full restart"
	@echo "  show-logs    - Show recent logs from files"
